!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Voice Dungeon Explorer</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; background: #111; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; font-family: Arial, sans-serif; 
        }
        .container { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 600px; padding: 20px; }
        .mic-button {
            width: 300px; height: 300px; border-radius: 50%; background: #222; border: 6px solid #fff;
            color: #ffffff; font-size: 24px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            transition: all 0.2s ease; margin-bottom: 20px;
        }
        .mic-button:active { transform: scale(0.95); }
        .mic-icon { font-size: 60px; margin-bottom: 15px; }
        .listening { background: #004400 !important; border-color: #44ff44 !important; }
        .start-button { background: #000044 !important; border-color: #4444ff !important; }
        .text-display {
            background: rgba(0,0,0,0.8); color: #fff; padding: 20px; border-radius: 10px;
            min-height: 120px; width: 100%; margin-bottom: 20px; font-size: 16px;
            line-height: 1.4; text-align: center; border: 2px solid #444;
        }
        #debug { 
            position: fixed; top: 10px; left: 10px; color: #fff; font-size: 11px; 
            background: rgba(0,0,0,0.9); padding: 10px; border-radius: 5px; 
            max-width: 300px; max-height: 200px; overflow-y: auto;
            font-family: monospace; line-height: 1.3; border: 1px solid #444;
        }
        .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
        .control-btn {
            background: #333; color: #fff; border: 1px solid #666; padding: 8px 16px;
            border-radius: 5px; cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .control-btn:hover { background: #555; border-color: #888; }
    </style>
</head>
<body>
    <div id="debug">Initializing Voice Dungeon Explorer...</div>
    
    <div class="container">
        <div id="textDisplay" class="text-display">
            Welcome to Voice Dungeon Explorer!<br><br>
            Click the button below to begin your audio adventure.<br>
            Make sure to allow microphone permissions when prompted.
        </div>
        
        <button id="micButton" class="mic-button start-button" onclick="handleClick()" aria-label="Voice command button">
            <div class="mic-icon">üé§</div>
            <div id="micText">TAP TO BEGIN</div>
        </button>
        
        <div class="controls">
            <button class="control-btn" onclick="testSpeech()">Test Speech</button>
            <button class="control-btn" onclick="testMicrophone()">Test Mic</button>
            <button class="control-btn" onclick="showCompatibility()">Check Browser</button>
        </div>
    </div>

    <script>
const debug = document.getElementById('debug');
        const micButton = document.getElementById('micButton');
        const micText = document.getElementById('micText');
        const textDisplay = document.getElementById('textDisplay');
        
        function log(msg) {
            const timestamp = new Date().toLocaleTimeString();
            const logMsg = `[${timestamp}] ${msg}`;
            console.log(logMsg);
            debug.innerHTML = logMsg + '<br>' + debug.innerHTML.split('<br>').slice(0, 12).join('<br>');
        }
        
        function displayText(text) {
            textDisplay.innerHTML = text;
            log('DISPLAY: ' + text.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
        }
        
        let browserSupport = {
            speechSynthesis: false,
            speechRecognition: false,
            webAudio: false,
            https: false
        };
        
        function checkBrowserSupport() {
            browserSupport.https = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
            browserSupport.speechSynthesis = !!(window.speechSynthesis && window.SpeechSynthesisUtterance);
            browserSupport.speechRecognition = !!(window.webkitSpeechRecognition || window.SpeechRecognition);
            
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    const ctx = new AudioContext();
                    browserSupport.webAudio = true;
                    ctx.close();
                }
            } catch (e) {
                browserSupport.webAudio = false;
            }
            
            log('Browser support check complete');
        }
function testSpeech() {
            if (!browserSupport.speechSynthesis) {
                displayText('Speech synthesis not supported. Try Chrome, Edge, or Safari.');
                return;
            }
            try {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance('Testing speech synthesis. If you hear this, speech works.');
                utterance.rate = 0.8;
                utterance.onstart = () => displayText('üîä Testing speech...');
                utterance.onend = () => displayText('‚úÖ Speech test completed!');
                utterance.onerror = (event) => displayText('‚ùå Speech test failed: ' + event.error);
                speechSynthesis.speak(utterance);
            } catch (error) {
                displayText('‚ùå Speech error: ' + error.message);
            }
        }
        
        function testMicrophone() {
            if (!browserSupport.speechRecognition) {
                displayText('Voice recognition not supported. Try Chrome, Edge, or Safari.');
                return;
            }
            if (!browserSupport.https) {
                displayText('Microphone requires HTTPS. Use GitHub Pages.');
                return;
            }
            try {
                const Recognition = window.webkitSpeechRecognition || window.SpeechRecognition;
                const recognition = new Recognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.onstart = () => {
                    displayText('üé§ Say something to test microphone...');
                    micButton.classList.add('listening');
                };
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    displayText(`‚úÖ Microphone working! You said: "${transcript}"`);
                    micButton.classList.remove('listening');
                };
                recognition.onerror = (event) => {
                    let errorMsg = 'Microphone test failed: ';
                    switch(event.error) {
                        case 'not-allowed': errorMsg += 'Permission denied. Allow microphone access.'; break;
                        case 'no-speech': errorMsg += 'No speech detected. Try speaking louder.'; break;
                        default: errorMsg += event.error;
                    }
                    displayText('‚ùå ' + errorMsg);
                    micButton.classList.remove('listening');
                };
                recognition.onend = () => micButton.classList.remove('listening');
                recognition.start();
            } catch (error) {
                displayText('‚ùå Microphone setup failed: ' + error.message);
            }
        }
        
        function showCompatibility() {
            const details = `Browser Compatibility:<br><br>HTTPS: ${browserSupport.https ? '‚úÖ' : '‚ùå'}<br>Speech: ${browserSupport.speechSynthesis ? '‚úÖ' : '‚ùå'}<br>Voice Recognition: ${browserSupport.speechRecognition ? '‚úÖ' : '‚ùå'}<br>Web Audio: ${browserSupport.webAudio ? '‚úÖ' : '‚ùå'}`;
            displayText(details);
        }
        
        const game = {
            player: { class: '', level: 1, health: 100, maxHealth: 100, mana: 50, maxMana: 50, gold: 25, inventory: [], position: { x: 0, y: 0 } },
            currentRoom: null, map: {}, listening: false, started: false, needsClass: true, initialized: false
        };
        
        const classes = {
            warrior: { name: 'Warrior', health: 120, mana: 30, gold: 50, items: ['Iron Sword', 'Health Potion', 'Leather Armor'] },
            mage: { name: 'Mage', health: 80, mana: 100, gold: 75, items: ['Magic Staff', 'Mana Potion', 'Cloth Robes'] },
            rogue: { name: 'Rogue', health: 100, mana: 60, gold: 100, items: ['Steel Dagger', 'Lockpicks', 'Studded Leather'] }
        };
        
        function speak(text, callback) {
            displayText(text);
            if (!browserSupport.speechSynthesis) {
                if (callback) setTimeout(callback, 2000);
                return;
            }
            try {
                speechSynthesis.cancel();
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(text.replace(/<[^>]*>/g, ''));
                    utterance.rate = 0.8;
                    if (callback) {
                        utterance.onend = callback;
                        utterance.onerror = callback;
                    }
                    speechSynthesis.speak(utterance);
                }, 100);
            } catch (error) {
                if (callback) setTimeout(callback, 2000);
            }
        }
let recognition = null;
        
        function startListening() {
            if (!browserSupport.speechRecognition || !browserSupport.https) {
                speak('Voice recognition requires HTTPS and a compatible browser.');
                return;
            }
            if (game.listening) { stopListening(); return; }
            try {
                const Recognition = window.webkitSpeechRecognition || window.SpeechRecognition;
                recognition = new Recognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.onstart = () => {
                    game.listening = true;
                    micButton.classList.add('listening');
                    micText.textContent = 'LISTENING...';
                    displayText('üé§ Listening for your command...');
                };
                recognition.onresult = (event) => {
                    const command = event.results[0][0].transcript.toLowerCase().trim();
                    displayText(`You said: "${command}"`);
                    stopListening();
                    setTimeout(() => processCommand(command), 1000);
                };
                recognition.onerror = (event) => {
                    stopListening();
                    speak('Voice error: ' + event.error);
                };
                recognition.onend = () => stopListening();
                recognition.start();
            } catch (error) {
                speak('Failed to start voice recognition: ' + error.message);
                stopListening();
            }
        }
        
        function stopListening() {
            game.listening = false;
            micButton.classList.remove('listening');
            micText.textContent = 'SPEAK';
            if (recognition) {
                try { recognition.stop(); } catch (e) {}
                recognition = null;
            }
        }
        
        function initializeGame() {
            game.initialized = true;
            micButton.classList.remove('start-button');
            micText.textContent = 'SPEAK';
            const welcome = "Welcome to Voice Dungeon Explorer!<br><br>Choose your class:<br><strong>WARRIOR</strong>, <strong>MAGE</strong>, or <strong>ROGUE</strong>";
            speak(welcome);
        }
        
        function handleClick() {
            if (!game.initialized) {
                initializeGame();
            } else {
                startListening();
            }
        }
        
        function processCommand(command) {
            if (game.needsClass) {
                if (command.includes('warrior')) selectClass('warrior');
                else if (command.includes('mage')) selectClass('mage');
                else if (command.includes('rogue')) selectClass('rogue');
                else speak('Please say WARRIOR, MAGE, or ROGUE');
                return;
            }
            if (command.includes('status')) characterStatus();
            else if (command.includes('inventory')) listInventory();
            else if (command.includes('help')) speak('Say STATUS, INVENTORY, or HELP');
            else speak('Unknown command. Say HELP for options.');
        }
        
        function selectClass(className) {
            const classData = classes[className];
            game.player.class = className;
            game.player.health = classData.health;
            game.player.gold = classData.gold;
            game.player.inventory = [...classData.items];
            game.needsClass = false;
            game.started = true;
            speak(`You are now a ${classData.name}!<br>Health: ${classData.health}<br>Gold: ${classData.gold}<br><br>Your adventure begins!`);
        }
        
        function characterStatus() {
            const player = game.player;
            speak(`Class: ${classes[player.class].name}<br>Health: ${player.health}<br>Gold: ${player.gold}`);
        }
        
        function listInventory() {
            const message = game.player.inventory.length === 0 ? 'Your inventory is empty.' : `Inventory:<br>${game.player.inventory.join('<br>')}<br><br>Gold: ${game.player.gold}`;
            speak(message);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            checkBrowserSupport();
            log('Voice Dungeon Explorer loaded');
        });
        
        micButton.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>
</body>
</html>
