<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Voice Dungeon Explorer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #111;
        }
        #micButton {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #222;
            border: none; /* Removed the border for a cleaner look */
            cursor: pointer;
        }
        #micButton:active {
            background: #444; /* Added a subtle color change on tap */
        }
        .listening {
            background: #004400 !important;
        }
        .start-button {
            background: #000044 !important;
        }
        /* Hide text display from view, but keep it for screen readers */
        #textDisplay {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div id="textDisplay"></div>
    <button id="micButton" class="start-button" onclick="handleClick()" aria-label="Voice command button"></button>

    <script>
        const micButton = document.getElementById('micButton');
        const textDisplay = document.getElementById('textDisplay');

        function displayText(text) {
            textDisplay.innerHTML = text;
        }

        let browserSupport = {
            speechSynthesis: false,
            speechRecognition: false,
            https: false
        };

        function checkBrowserSupport() {
            browserSupport.https = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
            browserSupport.speechSynthesis = !!(window.speechSynthesis && window.SpeechSynthesisUtterance);
            browserSupport.speechRecognition = !!(window.webkitSpeechRecognition || window.SpeechRecognition);
        }

        const game = {
            player: { class: '', level: 1, health: 100, maxHealth: 100, mana: 50, maxMana: 50, gold: 25, inventory: [], position: { x: 0, y: 0 } },
            currentRoom: null, map: {}, listening: false, started: false, needsClass: true, initialized: false
        };

        const classes = {
            warrior: { name: 'Warrior', health: 120, mana: 30, gold: 50, items: ['Iron Sword', 'Health Potion', 'Leather Armor'] },
            mage: { name: 'Mage', health: 80, mana: 100, gold: 75, items: ['Magic Staff', 'Mana Potion', 'Cloth Robes'] },
            rogue: { name: 'Rogue', health: 100, mana: 60, gold: 100, items: ['Steel Dagger', 'Lockpicks', 'Studded Leather'] }
        };

        function speak(text, callback) {
            displayText(text);
            if (!browserSupport.speechSynthesis) {
                if (callback) setTimeout(callback, 2000);
                return;
            }
            try {
                speechSynthesis.cancel();
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(text.replace(/<[^>]*>/g, ''));
                    utterance.rate = 0.8;
                    if (callback) {
                        utterance.onend = callback;
                        utterance.onerror = callback;
                    }
                    speechSynthesis.speak(utterance);
                }, 100);
            } catch (error) {
                if (callback) setTimeout(callback, 2000);
            }
        }
let recognition = null;

        function startListening() {
            if (!browserSupport.speechRecognition || !browserSupport.https) {
                speak('Voice recognition requires HTTPS and a compatible browser.');
                return;
            }
            if (game.listening) { stopListening(); return; }
            try {
                const Recognition = window.webkitSpeechRecognition || window.SpeechRecognition;
                recognition = new Recognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.onstart = () => {
                    game.listening = true;
                    micButton.classList.add('listening');
                    speak('Listening for your command.');
                };
                recognition.onresult = (event) => {
                    const command = event.results[0][0].transcript.toLowerCase().trim();
                    displayText(`You said: "${command}"`);
                    stopListening();
                    setTimeout(() => processCommand(command), 1000);
                };
                recognition.onerror = (event) => {
                    stopListening();
                    speak('Voice error: ' + event.error);
                };
                recognition.onend = () => stopListening();
                recognition.start();
            } catch (error) {
                speak('Failed to start voice recognition: ' + error.message);
                stopListening();
            }
        }

        function stopListening() {
            game.listening = false;
            micButton.classList.remove('listening');
            if (recognition) {
                try { recognition.stop(); } catch (e) {}
                recognition = null;
            }
        }

        function initializeGame() {
            game.initialized = true;
            micButton.classList.remove('start-button');
            const welcome = "Welcome to Voice Dungeon Explorer. To begin, click the button to choose your class: warrior, mage, or rogue.";
            speak(welcome);
        }

        function handleClick() {
            if (!game.initialized) {
                initializeGame();
            } else {
                startListening();
            }
        }

        function processCommand(command) {
            if (game.needsClass) {
                if (command.includes('warrior')) selectClass('warrior');
                else if (command.includes('mage')) selectClass('mage');
                else if (command.includes('rogue')) selectClass('rogue');
                else speak('Please say WARRIOR, MAGE, or ROGUE');
                return;
            }
            if (command.includes('status')) characterStatus();
            else if (command.includes('inventory')) listInventory();
            else if (command.includes('help')) speak('Say STATUS, INVENTORY, or HELP');
            else speak('Unknown command. Say HELP for options.');
        }

        function selectClass(className) {
            const classData = classes[className];
            game.player.class = className;
            game.player.health = classData.health;
            game.player.maxHealth = classData.health;
            game.player.mana = classData.mana;
            game.player.maxMana = classData.mana;
            game.player.gold = classData.gold;
            game.player.inventory = [...classData.items];
            game.needsClass = false;
            game.started = true;
            speak(`You are now a ${classData.name}! Health: ${classData.health}, Gold: ${classData.gold}. Your adventure begins!`);
        }

        function characterStatus() {
            const player = game.player;
            speak(`Class: ${classes[player.class].name}, Health: ${player.health}, Gold: ${player.gold}`);
        }

        function listInventory() {
            const message = game.player.inventory.length === 0 ? 'Your inventory is empty.' : `Inventory: ${game.player.inventory.join(', ')}. Gold: ${game.player.gold}`;
            speak(message);
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkBrowserSupport();
        });

        micButton.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>
</body>
</html>




